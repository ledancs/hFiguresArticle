%% BioMed_Central_Tex_Template_v1.06
%%                                      %
%  bmc_article.tex            ver: 1.06 %
%                                       %

%%IMPORTANT: do not delete the first line of this template
%%It must be present to enable the BMC Submission system to
%%recognise this template!!

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                     %%
%%  LaTeX template for BioMed Central  %%
%%     journal article submissions     %%
%%                                     %%
%%          <8 June 2012>              %%
%%                                     %%
%%                                     %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                                                 %%
%% For instructions on how to fill out this Tex template           %%
%% document please refer to Readme.html and the instructions for   %%
%% authors page on the biomed central website                      %%
%% http://www.biomedcentral.com/info/authors/                      %%
%%                                                                 %%
%% Please do not use \input{...} to include other tex files.       %%
%% Submit your LaTeX manuscript as one .tex document.              %%
%%                                                                 %%
%% All additional figures and files should be attached             %%
%% separately and not embedded in the \TeX\ document itself.       %%
%%                                                                 %%
%% BioMed Central currently use the MikTex distribution of         %%
%% TeX for Windows) of TeX and LaTeX.  This is available from      %%
%% http://www.miktex.org                                           %%
%%                                                                 %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% additional documentclass options:
%  [doublespacing]
%  [linenumbers]   - put the line numbers on margins

%%% loading packages, author definitions

\documentclass[twocolumn]{bmcart}% uncomment this for twocolumn layout and comment line below
%\documentclass{bmcart}

%%% Load packages
%\usepackage{amsthm,amsmath}
\RequirePackage{natbib}
\RequirePackage{hyperref}
\usepackage[utf8]{inputenc} %unicode support
\usepackage{pifont}
%\usepackage[applemac]{inputenc} %applemac support if unicode package fails
%\usepackage[latin1]{inputenc} %UNIX support if unicode package fails
\usepackage{multirow}
% Check : http://tex.stackexchange.com/questions/12703/how-to-create-fixed-width-table-columns-with-text-raggedright-centered-raggedlef
\usepackage{array}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\usepackage{morefloats}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                             %%
%%  If you wish to display your graphics for   %%
%%  your own use using includegraphic or       %%
%%  includegraphics, then comment out the      %%
%%  following two lines of code.               %%
%%  NB: These line *must* be included when     %%
%%  submitting to BMC.                         %%
%%  All figure files must be submitted as      %%
%%  separate graphics through the BMC          %%
%%  submission process, not included in the    %%
%%  submitted article.                         %%
%%                                             %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\def\includegraphic{}
\def\includegraphics{}



%%% Put your definitions there:
\startlocaldefs
\endlocaldefs


%%% Begin ...
\begin{document}

%%% Start of article front matter
\begin{frontmatter}

\begin{fmbox}
\dochead{Research}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter the title of your article here     %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{Health Figures: An Open Source JavaScript Library for Health Data Visualization}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter the authors here                   %%
%%                                          %%
%% Specify information, if available,       %%
%% in the form:                             %%
%%   <key>={<id1>,<id2>}                    %%
%%   <key>=                                 %%
%% Comment or delete the keys which are     %%
%% not used. Repeat \author command as much %%
%% as required.                             %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\author[
   addressref={aff1},                   % id's of addresses, e.g. {aff1,aff2}
   corref={aff1},                       % id of corresponding address, if any
   %noteref={n1},                        % id's of article notes, if any
   email={andres.ledesma@tut.fi}   % email address
]{\inits{JE}\fnm{Andres} \snm{Ledesma}}
\author[
   addressref={aff1},
   %noteref={n1},
   email={hannu.nieminen.o@tut.fi}
]{\inits{JRS}\fnm{Hannu} \snm{Nieminen}}
\author[
   addressref={aff1},
   %noteref={n1},
   email={mohammed.al-musawi@student.tut.fi}
]{\inits{JRS}\fnm{Mohammed} \snm{Al-Musawi}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter the authors' addresses here        %%
%%                                          %%
%% Repeat \address commands as much as      %%
%% required.                                %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\address[id=aff1]{%                           % unique id
  \orgname{Department of Signal Processing, Tampere University of Technology}, % university, etc
  \street{Korkeakoulunkatu 10},                     %
  \postcode{33720}                                % post or zip code
  \city{Tampere},                              % city
  \cny{Finland}                                    % country
}
%\address[id=aff2]{%
%  \orgname{Marine Ecology Department, Institute of Marine Sciences Kiel},
%  \street{D\"{u}sternbrooker Weg 20},
%  \postcode{24105}
%  \city{Kiel},
%  \cny{Germany}
%}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter short notes here                   %%
%%                                          %%
%% Short notes will be after addresses      %%
%% on first page.                           %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{artnotes}
%\note{Sample of title note}     % note to the article
%\note[id=n1]{Personal Health Informatics Research Group} % note, connected to author
\end{artnotes}

%\end{fmbox}% comment this for two column layout

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% The Abstract begins here                 %%
%%                                          %%
%% Please refer to the Instructions for     %%
%% authors on http://www.biomedcentral.com  %%
%% and include the section headings         %%
%% accordingly for your article type.       %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{abstractbox}

\begin{abstract} % abstract

\parttitle{Background} %if any
The way we look at data has a great impact on how we can understand it, particularly when the data is related to health and wellness. Due to the increased use of self-tracking devices and the ongoing shift towards preventive medicine, better understanding of our health data is an important part of improving the general welfare of the citizens. Electronic Health Records, self-tracking devices and mobile applications provide a rich variety of data but it often becomes complex and difficult to understand. We implemented the hFigures library inspired on the hGraph visualization with additional improvements. The purpose of the library is to provide a visual representation of the evolution of health measurements in a comprehensive and holistic manner. 

\parttitle{Results} %if any
We built an application using the hFigures library for health data visualization of a modeled patient in a health coaching program. We performed a user evaluation with Heuristic Evaluation, Controlled User Testing and Usability Questionnaires. The results show that users find the application helpful in the decision making process of the health assessment of the modeled patient during the health coaching program.

\parttitle{Conclusions} %if any
We developed hFigures, an open source library for visualizing a holistic, normalized and comprehensive graphical representation of health data. The idea is based on the concept of the hGraph but it provides additional key features, including a comparison of multiple health measurements over time. We conducted a comprehensive usability evaluation of the library as a key component of an application for health and wellness monitoring. The results show that the data visualization library has indeed helped users to better understand health data.

\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% The keywords begin here                  %%
%%                                          %%
%% Put each keyword in separate \kwd{}.     %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{keyword}
\kwd{data visualization}
\kwd{health data}
\kwd{health informatics}
\kwd{javascript}
\end{keyword}

% MSC classifications codes, if any
%\begin{keyword}[class=AMS]
%\kwd[Primary ]{}
%\kwd{}
%\kwd[; secondary ]{}
%\end{keyword}

\end{abstractbox}
%
\end{fmbox}% uncomment this for twcolumn layout

\end{frontmatter}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% The Main Body begins here                %%
%%                                          %%
%% Please refer to the instructions for     %%
%% authors on:                              %%
%% http://www.biomedcentral.com/info/authors%%
%% and include the section headings         %%
%% accordingly for your article type.       %%
%%                                          %%
%% See the Results and Discussion section   %%
%% for details on how to create sub-sections%%
%%                                          %%
%% use \cite{...} to cite references        %%
%%  \cite{koon} and                         %%
%%  \cite{oreg,khar,zvai,xjon,schn,pond}    %%
%%  \nocite{smith,marg,hunn,advi,koha,mouse}%%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%% start of article main body
% <put your article body there>

%%%%%%%%%%%%%%%%
%% Background %%

\section*{Introduction}
The ongoing shift from reactive to preventive medicine requires that citizens have the skills and means to take an active role in developing and maintaining their wellness. Use of self-tracking devices and personal wellness applications is more and common, ranging from sports tracking applications to personal genome sequence analysis sevices. These services and devices produce large amounts of data. In addition, Electronic Health Records are increasingly replacing paper records in hospitals and clinics around the world. The combination of these large and heterogeneous data sources is expected to provide a ``predictive, preventive, personalized and participatory'' ecosystem for the benefit of the general welfare \cite{Hood2012613}.

To better understand our health, we need to combine heterogeneous data sources and present the information to the user with a comprehensive and holistic approach. In order to accomplish this, health information technologies and visualization design need to be integrated \cite{lesselroth2011data}. The goal is to provide tools for individuals to take better  decisions regarding their health. Similarly, doctors and other medical experts need tools and solutions for getting a comprehensive view of the patients health, combining together patient's own measurements and clinical data.

% I think we cannot say that the "earlier study users provided feedback what hGraph was missing"
% it was not the scope and focus of the paper.... 
% I think here we should more discuss what we think is needed for a good overview of health status and its evolution over time and mention hGraph as an example.  
% Here's my proposal for this paragraph
An innovative approach for health data visualization is the Health Graph (hGraph), released publicly by MITRE corporation \cite{follett2012hgraph}. In an earlier study \cite{EMBCLedNiem}, it was found that the hGraph-type radial plot can enhance deep understanding of health data and enable the user to create meaningful health insights based on the interrelationships between the measurements. However, the hGraph shows a static overview of a persons wellness. Disease and wellness are processes that change over time. It is also essentially important to be able to follow up the trajectories in the different parameters, what is the rate of the change and how they respond to events such as medical care actions and interventions. Thus, in addition to a static snapshot such as in hGraph, a temporal way of presenting the data is also needed. While hGraph visualization is useful for the purpose of understanding with a quick glance the overall situation, it lacks features such as a clear division of measurements according to their category, a distribution of the labels to avoid clutter and the notion of time or \textit{evolution} of the data \cite{EMBCLedNiem}. 

% Here is the earler text for reference
%An innovative approach for health data visualization is the Health Graph (hGraph), released publicly by MITRE corporation \cite{follett2012hgraph}. Based on a previous study \cite{EMBCLedNiem}, we found that the hGraph enhances deep understanding of health data and enables the user to create meaningful health insights based on the interrelationships between the measurements. However, the hGraph shows a static overview of a persons wellness. That is, the values of multiple measurements at one point in time. While this visualization is useful for the purpose of understanding with a quick glance the overall situation, it lacks features such as a clear division of measurements according to their category, a distribution of the labels to avoid clutter and the notion of time or \textit{evolution} of the data. In our previous study \cite{EMBCLedNiem}, users provided feedback on what the hGraph was missing to help them understand the data. We built a visualization library based on this feedback. and open sourced our library under the name Health Figures, or hFigures for short. 

% Hannu's comment to address...
% We should add some sentences about that link to reviewer one comments about the polar plot. This could be a new paragraph after the second chapter (now ending “…. And clinical data”.  In the introduction we could state first something about “ … several parameters are interlinked and affect the disease and wellness…” and justify why a snapshot of the current state is important. But then we should also state that l“…Disease and wellness are processes that change over time.  This it is also essentially important to be able to follow up also the trajectories in the different parameters, what is the rate of the change  and how they respond to events such as medical care actions and interventions.”  
 
% This hypothesis part does not work yet
% we cannot I think refer in this kind of way to an earlier study
% Test both during and after development the user satisfaction, ease-of-use and usefulness of the developed solution. I propose the following text
In this article we present a visualization library that aims to assist experts and non-experts in the decision making process of assessing the situation of a patient and its evolution over time. To test the user satisfaction, ease-of-use and usefulness of the solution, we built an application for health monitoring using the visualization library . The application is a visualization tool that shows a health coaching program and its effects on the evolution of a modeled patient. We evaluated the software solution using usability tests (Heuristic Evaluation, Controlled User Testing and Usability Questionnaires).  

% this was your earlier text
%Our hypothesis is postulated as follows, if we fulfill the users' needs from the previous study, we can develop a visualization library that can assist users in the decision making process of assessing the situation of a patient and its evolution over time. In order to test our hypothesis, we built an application for health monitoring. The application is a visualization tool that shows a health coaching program and its effects on the evolution of a modeled patient. We evaluated the software solution using usability tests (Heuristic Evaluation, Controlled User Testing and Usability Questionnaires). The results show that the library helped users to understand better the patient's health situation and its changes over time.

First in this article we present the background research we did on health data visualizations, the hGraph and the previous study as a motivation for the development of hFigures. The article details the design and implementation of the hFigures library, the features we implemented and how they address the users' needs. We also describe the usability test process we utilized to assess the library in the context of an application for health monitoring. We present the results and discuss the further improvements of the library and its pitfalls. We also discuss how this library can be used in Personal Health Informatics and in the Health Care processes.

\section*{Background}

% \subsection*{Related Work}

% This needs to flow a bit better... DONE!

Visualization tools have mostly focused on Healthcare Information Systems and Electronic Health Records (EHR) \cite{lesselroth2011data}. For instance, TimeLine is a software developed to retrieve data from several sources and presented in a hierarchical and timeline based structure where clinicians can browse chronologically through existing EHRs including MRI \cite{bui2007information}.

Additionally, the growing market for mobile health applications (mHealth) have drawn the attention of researchers, developers and investors \cite{mHealth2014}. These applications provide large volumes of personal health data. While the market and demand are expected to grow, the use of the data has the potential to contribute to a better understanding of our health.

Goetze \cite{goetz2015} demonstrated the impact of data visualization as means to represent health data in a comprehensive manner. He conducted a project that redesigned laboratory test results from numerical tables into colored graphics. He demonstrated that the patients were able to understand better their health situation when presented with the new designs.

Data integration for health monitoring as a Big Data process for personalized medicine has been approached by \cite{7072838}. The visualization of this information uses traditional bar and pie charts to report to the user a historical view of a variety of data including mental, social, physical aspects. The novelty of this work is the integration of heterogeneous data sources while the presentation of the information was done following existing graphical representations.

An extensive choice of graphical representation is listed and explained by S. Few \cite{few2006information}. These techniques have been studied and used widely among researchers and individuals alike. Examples include: bar, stacked bar, line and bullet graphs. These visualizations can be combined to provide a personalized wellness indicator system, as proposed by Soomlek and Benedicenti \cite{Soomlek:2013:AWI:2532685.2532686}.

DeRidder \textit{et al.} developed a combined approach that retrieves data from Personal Health Records (PHRs), and presents them to individual patients using a ``3D medical graphical avatar'' \cite{de2013web}. The solution is built using HTML5 and WebGL to render 3D graphics using the web browser. Patients can browse ``regions of interests'' on their avatar and explore further the information contained in EHRs as well as in PHRs.

As stated by Shneiderman \textit{et al.} \cite{shneiderman2013improving}, new visual representations are needed for ``systematic yet flexible visual analytics processes''. We present an existing tentative solution known as the hGraph, released publicly by MITRE corporation. We describe its main advantages and how they can address these challenges. In a previous study we identified possible improvements and based on our own implementation we addressed these issues and extended the features of the hGraph to better address complex data sources.

However, a data visualization is only as good as the ability of the intended audience to decode graphical objects into numerical values which conveys a clear message. Therefore, we have to consider the graphical perception of the users who will benefit from the data visualization. Graphical perception is the ability of an individual to decode the information displayed as graphical objects \cite{baird1978fundamentals}, it has been a widely researched field \cite{cleveland1984graphical}. Graphical perception affect how we understand visualized information. In the context of health data, it remains a challenge to design graphical representations for non-medical experts. Graphical representations in this context should enhance the users' ability to understand their health situation and take informed decisions. With this ``deep'' understanding on the health situation, individuals can move towards healthier behaviors.

\subsection*{Radar Plots}

% Background research on radar plots.

Radar plots scale to large amounts of data entries because the points are distributed among the circumference. Bar charts, lines or scattered plots, pie charts and similar visualizations can quickly grow to a large scale with large datasets. In the case of radar plots, the graphical representation scales with the number of points plotted causing the circumference to grow in order to accommodate all the plotted values. Plotted values remain uniformly distributed along the circumference.

\subsection*{The Health Graph}

The health graph, or hGraph was developed by MITRE Corporation and released to the public in 2010 under the Apache v2.0 license. The design intention of the hGraph is to facilitate the graphical representation and understanding of health data. The data can come from a wide-range of sources such as laboratory tests, physical activity, nutrition, sleep monitors and other sources. The domain of this visualization technique includes Personal Health Informatics, EHR and Personal Health Record (PHR) visualization \cite{follett2012hgraph}.

% refer to the figure to improve clarity
The design consists of a circular space with an area defined by to circumferences. The area represents the minimum and maximum recommended values for a given measurement. For instance, the minimum and maximum fat percentage of a person in a given age. The measurements are represented as circles and their position in the circular space represents how far or close they are from the recommended values. The position is normalized according to the recommended values.

The values are distributed in a circular space. A graph is formed by joining the data points around the circular area. This polygon or graph reveals a pattern and its shape provides a quick overview of the general situation of all the values and how they deviate from the recommendations. The hGraph design highlights values outside of the recommendation by using the red color on the data points and by modifying the shape of the graph. The rationale of the hGraph is that if the same measurements are plotted in the same order for various cases, then the graph patterns can reveal similar shapes associated with certain health conditions.

\paragraph*{Web-based Solution}
Web-based solutions for data visualization provide flexibility, as they can be accessed by any web browser, either from mobile devices or personal computers. The hGraph uses a web approach via HyperText Markup Language (HTML) and Scalable Vector Graphics (SVG). The programming language of the library is JavaScript and is built using the Data-Driven Documents library. Data-Driven Documents (D3.js) library provides free access to the Document Object Model (DOM), which is the substrate that enables the programmer to interface with the graphical representations in a web browser \cite{bostock2011d3}.

\paragraph*{hGraph as an Insightful Visualization}
Based on the approach proposed by C. North \cite{north2006toward}, a previous study compared visualizations based on how well users derived meaningful insights. The study compared the hGraph visualization along with four alternatives based on the Graphical Perception Framework proposed by Cleveland McGill \cite{cleveland1984graphical}. The study compared the same data plotted with these five alternatives plus a control group which had the numerical data with no visualization. The data was comprised by a set of measurements of two modelled patients. The first patient had an elevated at risk of developing Type II Diabetes and the second one had a low risk due to a healthy lifestyle (regular exercise and a balanced diet). The evaluation followed the insight-based methodology similar to other experiments for visualizing genetic expressions \cite{saraiya2004evaluation}. The experiment determined how these visualizations can enable users to understand the overall health situation of the modelled patient with poor health, as well as the possible causes behind that patient's situation. The hGraph was found to be the most effective solutions for creating meaningful insights and to help users to better understand the data.

% HANNU: This next chapter starting with Data points... need sclarification, the meaning is not totally clear.

% Andres: Yes agreed! I have rewritten the whole paragraph to include more examples and remove the use of the term "data points".

% This is a common advantage of radar plots. Moving some text to Radar Plots section.
% The hGraph scales to large amounts of data entries since the measurements, represented as circles, are distributed among a circumference. Other visualizations, such as bar charts, lines or scattered plots, can quickly take a large space when plotting large datasets. As more measurements are added, the circular space utilized in the hGraph will eventually stretch to accommodate large datasets, but the distribution stays uniform along the circle and the space required is still less than with other alternative visualizations.

Figure \ref{figureHGraphZoom} is an example of the hGraph visualization. The figure was extracted as a snapshot as the library generates an SVG document structure that cannot be exported outside the browser. We address this issue in the next section of the article. The hGraph hides the measurements when the zoom level is low, meaning that the user has zoomed out. The shape is an average of the deviation of each measurement under the same category. When the user zooms in, the details are revealed and the rest of the information becomes visible, that is the numerical values and positions (with respect to the recommendation) of the measurements.

\section*{Implementation} 

% Throughout the design and implementation of our library, we adopted a user-centered approach. Invited users gave us continuous feedback on how they would understand the data better and what features would improve their experience with the library. Based on iterative design sessions and implementation of prototypes we developed the features based on how they enhance the usability and utility of the library. We named our library Health Figures (hFigures) based on the fact that we obtained our inspiration from the hGraph but eventually extended the library to include multiple graphs giving the notion of several intertwined figures.

% This chapter explains the implementation process in our approach based on user feedback and on previous experiments \cite{EMBCLedNiem}. 

\subsection*{Methodology}

% Either User-Centered or Extreme Programming.
% We stick to Extreme Programming
% sources missing:
% "Human Centred Technology Workshop 2005", 2005, PDF webpage: Informatics-UK-report-cdrp585.
% "Design Patterns and Refactoring", University of Pennsylvania, 2003, webpage: UPenn-Lectures-design-patterns.
% "Extreme Programming" USFCA-edu-601-lecture.

The implementation of the hFigres followed the Extreme Programming methodology \cite{roebuck2012agile, beck2000extreme}. The requirements came from the previous study using insight-based methodology and briefing interviews \cite{EMBCLedNiem}. Extreme Programming focuses on continuous release of software and constant validation with its users. Often these requirements change and the programming practice is to address this changes to the ``extreme'', meaning to prioritize them at the top of the change list in order to produce a new release and receive feedback as soon as possible.

In our development stage our research group provided feedback on the library. Our research group has expertise in Health Sciences, Signal Processing, User Design, Software Engineering and Machine Learning. Requirements often changed and constant releases were assessed by our research group. The development of the health monitoring application for the usability testing followed the practice of pair reviewing.



\subsection*{Data Source}

We use a JSON (JavaScript Object Notation) format to read the data, in which the measurements are grouped according to their categories. The groups contain an array of samples, which represent the values obtained from a measurement (steps per day, cholesterol, triglycerides, blood sugar or depression level using \cite{poutanen2010validity}). The samples contain a timestamp in Unix Epoch format and the value of the measurement. The Unix Epoch format is the number of seconds since the first of January 1970, Greenwich Meridian Time (GMT). An example of the data source is in figure \ref{codeDataSource}, it shows the first measurement of the group "Blood Pressure" which in this case is comprised by Systolic and Diastolic measurements and each of them have two samples taken at two particular times, Friday 9th of January 2015 at 10:10:24 GMT (1420798224 --- seconds) and Thursday 12th of February 2015 at 12:05:20 GMT (1423742720 --- seconds).

\subsection*{SVG Document Export}

The SVG document structure we designed in our implementation can be exported to a separate file outside the web browser. The short-term objective is to build a tool-kit that enables researchers to visualize their data with our implementation so they can use the generated SVG file in articles, posters, presentations or other applications. For instance, figure \ref{figureHFiguresSimple} has been exported as an SVG document from the browser into this article. SVG export is possible due to the rendering of our algorithm which does not depend on JavaScript or Cascade Style Sheet (CSS) styling properties to produce a finalized document. The library build the entire image as a stand-alone document. The hGraph library unfortunately does not produce a complete document but instead depends on CSS and JavaScript code to make the image visible.

\subsection*{Constant Graph Shape}

Figure \ref{figureHGraphZoom} shows an hGraph example and figure \ref{figureHFiguresSimple} shows an hFigures example. The hGraph computes the average of the deviation of the measurements in order to show the polygon or graph, as a representation of the overall health assessment. However, some measurement might deviate towards a lower value and while others towards a higher one, thus the average position would be roughly the middle recommended area. For this reason, hFigures does not change the shape of the graph if the user zooms in or out. Showing and hiding the measurement labels is the only reaction to the zooming events from the user at the moment. This avoids clutter when the user wished to have a quick glance at the picture but keeps the graph with the same shape.

\subsection*{Layout Construction}

The measurement groups are represented using a circular layout divided in sectors. The goal is to have a clear division between the groups as they represent the different aspects of the overall health. hFigures uses the d3 pie chart layout and modifies the data source provided to the layout. All the measurements have the same numerical value and at the end of the group, we insert an extra value in order to leave a blank space between the circular area sectors. The result is visible in the hFigures example shown in figure \ref{figureHFiguresSimple} and the code that produced this visualization is in figure \ref{codeLayoutConstruction}. The pie layout constructs the sectors of the circular area based on a data source. When we provide an array of numbers, the layout uses the numbers to calculate the proportions of the area. In order to achieve the layout construction that we have designed, the array has the same constant number multiple times, the number of measurements plus an additional number for each group. 

\subsection*{Color-coded Entries}

The data source can contain additional sets of value ranges. For instance a warning range of values can let the users know when a value has reached a level that requires attention but has not yet reached a critical point. We followed the users' feedback that recommends a traffic light-based approach. The green color means that the values are within the recommended, yellow suggest a warning or follow-up action needed and the red indicated a critical threshold has been passed.

In the implementation, the library verifies if these additional ranges are present in the measurement definition. In order to verify if the property of the object exists, JavaScript provides a qualifier method, \texttt{typeof}. The returned value must be compared with the keyword definition for properties that are not present in an object, the keyword \texttt{undefined} has been suggested by Mozilla Developer Network \cite{MDNJS}, a highly reputable source for Web development. The code is shown in figure \ref{codeColorCoded}.

\subsection*{Multiple Graph}

The dataset is structured as a set of measurements where each has its own collection of samples. In order to compare the evolution of these measurements, the hFigures library allows the graphical representation of any number of samples. The result is a set of graphs or polygons overlapping or stacking with each other. In order to differentiate them, we use a lighter set of colors so that the users can see the difference between two points in time. As an example, figure \ref{figureHFiguresSimple} shows two different samples for each measurement. This example portrays a modeled person that has been active in a health coach program. Some measurements have improved and are closer to the recommendation. Users repeatedly expressed that it would be very helpful to visualize two or more different points in time so as to compare how the person has evolved. 

Including multiple graphs has implications in the structure and procedures of the visualization construction. For instance, we structured the SVG document such that each measurement includes one or many plotted circles that map to each sample. The measurement labels need to be positioned considering that a plotted circles can (and probably will) overlap. This is challenge that we address in the next section by finding an optimal label space distribution to avoid labels from overlapping and also to reduce the clutter in the visualization space.

\subsection*{Label Space Distribution}

After the measurements are plotted, the labels are added to increase readability. The position of the label needs to be defined within a given range to avoid overlaps and clutter.

% Mention the margin can be specified also by the user

Labels need to avoid overlapping with each other and with their measurements. To solve the label overlapping problem we implemented an algorithm that starts by ordering the labels by their angular position, that is the angle at which the measurement is positioned. The next step is to calculate the height of the label and position it over the previous one in the direction that goes from the center of the visualization area upwards or downwards (depending on the angle). The idea is to begin with the center of the area, either to the left or to the right of the circles, then we work our way up or down drawing the labels into the SVG document. We add the labels as SVG elements and the use the \texttt{transform} property to position them in the corresponding place. Figure \ref{figureVerticalLabelDistribution} shows the spacing between the labels using the algorithm when drawing the labels from the center to the upper right corner. For each of the four quadrants, the library calls the method shown in figure \ref{codeVerticalLabelDistribution} which computed the position of the label as we described.

As mentioned before, labels can also overlap with measurement circles. To avoid this problem we calculate the maximum radius from the center of the visualization area to the highest value of a measurement sample. From that starting point, we place the label in that position. In other words, for each measurement, we find the largest value of the samples. Figure \ref{figureRadiusMeasurementDistrbution} shows a sector of the hFigures where the sugar measurement label has been pushed out for a few pixels in order to avoid overlapping it with the red circle. The rest of the labels adjust to that position by leaving a user-defined margin.

\begin{equation} \label{eq:maxRadius}
	r_{label} = max(\bigcup_{i}^{n} \left \{ r_{i} \right \} ) + \textit{margin}
\end{equation}

The radius for the label is the maximum value of the samples translated as graphical coordinates plus a margin. Equation \ref{eq:maxRadius} obtains the label radius $r_{label}$ given the radii of the samples of a measurement plus the default margin $m$.

% \subsection*{User-centred Design}

% IMPORTANT Specify the ISO!

% HANNU: I would leave out the sentence about the expertise areas of the users. 
% Andres: While it is true that we had a mixed audience in our design process, I think you are right. We should try to simplify the idea of the user-centered design in the paper.
% Andres: Now reviewers are asking for more detail so I will add this with the methods we used, which was onl the interview type because we demonstrated the prototype and gathered the feedback from the research group.
% From the expertise perspective we had a medical doctor, signal processing, usability, data science, machine learning and software engineering feedback.

% The users that participated in the design of the library have several areas of expertise including : Medical Sciences, Signal Processing, Machine Learning, Statistics, Software Engineering and User Experience.  The user-centred approach provided us timely feedback to decide on the features that are more important to the intended users. Table \ref{tbl:features} lists the supported features of hFigures compared to the hGraph. This section summarized the key differences and improvements of hFigures.

\subsection*{Feature Implementation Summary}

The key improvement of hFigures is the addition of multiple graphs as a mechanism to compare the values of the health measurements over time.

The immutable shape of the graph presents the same information (values of the measurements in respect to the recommended target) regardless of zooming. This feature shows the data ``as is'' without calculating average, mean or deviation. Users stressed the importance of graphically representing the information without any calculations such as mean or accumulated values. The users expressed that showing the measurement values in hFigures helped them to derive valuable insights with just a quick glance at the data, for instance they identified measurement that fall outside of the recommended range easier and without requiring them to zoom in or out.

The hFigures library does not calculate an overall score since the users considered that this task should be the sole responsibility of a health care professional. An overall score also depends on each person under a case by case basis. For instance, the hGraph allows the user to assign weights to each measurements' value, the score is then calculated summing the value of the weights times the measurement's deviation from the recommendation. The users participating in the design process of our library expressed that an overall score would complicate the integration of the library into daily health care processes as specialists would need to review case by case to find the adequate score formula, which means specifying the weights (importance) of each measurement for a given person.

Measurements in the hFigures library are grouped in sectors which represent the category they belong to. Grouped measurements allow a clear division of categories resulting in enhanced understanding on how certain areas of wellness have changed and how, if any, they affect each other. The sectors remain visible regardless of the zoom level, users expressed that this feature provides an informative approach as the categories are always showing to which category the measurements belong to. Hiding the category labels and displaying the measurements without divisions would complicate understanding the status of health categories, such as sleep, nutrition, physical activity and others. Users expressed their confusion when they were unable to determine when a category starts or ends after zooming in and out of the hGraph.

The possibility to export the generated figure as an SVG file, allows the integration into research articles, presentations, websites, posters and other Software applications to further enhance the utility of the hFigures.

\section*{Evaluation}

The health data visualization library was placed in the context of a full application. We tested the library in a contextualized scenario where the users conducted a series of tasks and answered usability questionnaires. In this section we present the methods we used for recruiting the participants and for the usability testing of the library. We also explain the metrics measured and the rationale behind the selection of the usability testing methods.

Nielsen suggests that ```usability has multiple components and is traditionally associated with the five usability attributes, which are learnability, efficiency, memorability, errors, and satisfaction'' \cite{nielsen1994usability}. In order to assess the usability of the software solution, multiple alternatives exist in industry and research. Johnson \textit{et al}. developed a toolkit for usability testing of Electronic Health Records commissioned by the Agency for Healthcare Research and Quality of the U.S. Department of Health and Human Services \cite{johnson2011ehr}. The toolkit is built on the basis of the assessment of existing usability methods in the context of Electronic Health Records and Health Information systems. The toolkit is a detailed analysis of the usability methods, their advantages, disadvantages and appropriateness ranking.

We selected the Usability Questionnaires since it has a high appropriateness ranking \cite{johnson2011ehr}. We were able to recruit three usability experts to conduct the Heuristic Evaluation and the Cognitive Walkthrough, both are recommended techniques to complement the evaluation. We concluded the evaluation with Controlled User Testing since we had a laboratory and the necessary tools to conduct the tests.

\subsection*{Continuous Health Monitoring Application}

In order to test the hFigures library, we designed an application for visualizing the health situation of a modeled patient and how this has changed over time within health coaching program. The objective is to help the users in the decision making process of assessing the overall health situation and weather or not the health program has provided benefits.

The application has three components: activity timeline, the hFigures data visualization library and longitudinal measurements.

\paragraph*{Activity Timeline} This component represents the health interventions (particular actions) that the modeled patient has done during the health coaching program. During the program, several snapshots of the patient's overall health are taken and visualized using the hFigures library.

\paragraph*{hFigures} The set of measurements taken during the health coaching program is a holistic view of the health situation of the modeled patient. This is suitable to be displayed using the hFigures library which we present in the application. Users can change the time at which the snapshot was taken to compare changes over time as a result of the health interventions.

\paragraph*{Longitudinal Measurements} The application also displays the same set of measurements using longitudinal representation. We included this component to provide additional details on how measurements have changed over the coaching program.

\subsection*{Heuristic Evaluation}

Heuristic Evaluation requires at least one expert in the area of human-computer interaction \cite{nielsen1994usability, johnson2011ehr}. For our evaluation we recruited three experts, they assessed the application using Nielsen's heuristics \cite{nielsen1994usability}. The evaluation has 11 metrics evaluated using a seven point Likert scale, where the value 1 indicates ``strongly disagree'' and 7 ``strongly agree''

% REF here!
% http://www.nngroup.com/articles/ten-usability-heuristics/

Heuristics are ``rules of thumb'' comprised of 10 principles meant to assist the Human-Computer Interaction specialist in the usability assessment \cite{johnson2011ehr, Nielsen10UsabilityHeuristics}. We explain the principles of the Heuristic Evaluation according Nielsen \cite{Nielsen10UsabilityHeuristics}.
\begin{enumerate}
\item \textit{Visibility of the System Status}: Refers to continuous feedback on the status of the system ``within reasonable time'' (Feedback).
\item \textit{Match between system and the real world}: The use of the language should be familiar to the user so that conversations follow a ``natural and logical order'' avoiding technical terminology unfamiliar to the intended user audience (Speak the User's Language).
\item \textit{User control and freedom} : Allow the user to recover from erroneous navigational options with ``clearly marked'' access options (Clearly Marked Exits).
\item \textit{Consistency and standards} : Follow the same language and terminology to avoid the user from guessing the meaning of ``words, situations, or actions''(Consistency).
\item \textit{Error prevention} : Avoid ``error-prone'' options in the system whenever possible and for those cases when the problematic options cannot be avoided, then present the user confirmation dialogues (Prevent Errors).
\item \textit{Recognition rather than recall} : Present visible options to the user at all times so as to avoid the effort of remembering previously stated instructions. Whenever options cannot be visible, make them ``easily retrievable whenever appropriate'' (Minimize User Memory Load).
\item \textit{Flexibility and efficiency of use} : The interface should accommodate the novice and advance user by providing ``tailored frequent actions'' (Shortcuts).
\item \textit{Aesthetic and minimalist design} : The dialogues should only contain relevant and clear information that is timely needed at that particular state of the interface (Simple and Natural Dialogue).
\item \textit{Help Users recognize, diagnose, and recover from errors} : Plain language should be used in error messages, and whenever possible they should provide helpful information so that the users can take constructive actions. (Good Error Messages)
\item Help and documentation : In some, systems require documentation and guidelines to explain briefly how to accomplish specific tasks in ``concrete steps''.
\end{enumerate}

\subsection*{Cognitive Walkthrough}

Wharton \textit{et al}. developed the Cognitive Walkthrough for usability testing \cite{wharton1994cognitive}. Johnson \textit{et al}. summarize this method as a ``usability inspection method that compares the users’ and designers’ conceptual model and can identify numerous problems within an interface'' \cite{johnson2011ehr, wharton1994cognitive}.

Cognitive Walkthrough has successfully been used to evaluate usability of Healthcare Information Systems \cite{johnson2011ehr, peute2007significance, karahoca2010information, cohen2004cognitive, khajouei2009usability} and Web Information Systems \cite{blackmon2002cognitive}.

Since Cognitive Walkthroughs ``tend to find more severe problems'' \cite{sears1997heuristic, johnson2011ehr} but ``fewer problems than a Heuristic Evaluation'' \cite{beuscart2007human, johnson2011ehr} we included both methods in our evaluation.

\subsection*{Laboratory Testing}

Regarded as the ``golden standard'' for usability testing \citep{newman199810}, Laboratory Testing collects ``qualitative and quantitative'' data ``since it collects both objective data such as performance metrics (e.g., time to accomplish the task, number of key strokes, errors, and severity of errors) and subjective data such as the vocalizations of users thinking aloud as they work through representative tasks or scenarios'' \cite{johnson2011ehr}. 

Controlled user testing is comprised of ``a series of commonly used task scenarios'' where users are asked to conduct these tasks using a ``thinking aloud'' \cite{johnson2011ehr, ericsson1980verbal, nielsen1994usability}. This process requires ``users to talk aloud about what they are doing and thinking'' while they complete the tasks using the system \cite{johnson2011ehr, ericsson1980verbal, nielsen1994usability}.

As the ``golden standard'' in usability testing, this method has been widely used in evaluating Health Information Systems \cite{johnson2011ehr, borycki2009novice, currie2003clinical, hasman2006development, wu2008usability}

The data exploration tasks are designed to assist the decision making process on the health situation of the modeled patient. The usability scenario was the main goal of the intended use of the application. We explain the participants the purpose of the application, which is to facilitate the decision making process weather or not the overall health situation of the modeled patient is favourable and weather or not the health coaching program was beneficial for the patient. The tasks are designed to represent the common usage of the application, namely to find the measurements inside and outside of the recommendation and to identify the areas that improved and need even further improvement. The tasks given to the participants are shown in the following list.
\begin{enumerate}
\item How many areas of health are displayed in the hFigures?
\item Choose one of these areas and point to its measurements.
\item Identify one measurement inside the recommended values and another one outside.
\item Identify the measurement that is the furthest from the recommended values.
\item What does the green, yellow and red circles mean?
\item Has the overall health improved after coaching?
\item Which area of health has improved the most after health coaching?
\item Which measurements show the biggest improvement?
\item Understand the difference between the points inside and outside the recommended area.
\end{enumerate}

\subsection*{Usability Questionnaires}

We followed the recommendations from Johnson \textit{et al}. and used this method in our evaluation. Usability Questionnaires are ``the most common'' method to ``collect self-reported data'' from the ``users’ experience and perceptions after using the system in question'' \cite{johnson2011ehr}. Although the data collected is self-reported, some questionnaires have reliability in measuring several usability metrics such as ``satisfaction, efficiency, effectiveness, learnability, perceived usefulness, ease of use, information quality, and interface quality'' \cite{johnson2011ehr}.

We used two Usability Questionnaires to evaluate the usability of our application, Computer System Usability Questionnaire (CSUQ) and After Scenario Questionnaire (ASQ) \cite{lewis1995ibm}. Table \ref{tbl:questionnaires} shows the length, reliability and the metrics of the questionnaires. These questionnaires use a seven-point Likert scale from ``strongly disagree'' up to ``strongly agree''.

\paragraph*{Computer System Usability Questionnaire (CSUQ)} The questionnaire was developed by IBM and it is a ``slight'' modification of the Post-Study System Usability Questionnaire (PSSUQ) \cite{lewis1992psychometric}. Table \ref{tbl:questionnaires} shows the reliability of this questionnaire. The questionnaire has high `` coefficient alpha'' with a reliability 0.95 in total and ``0.93 for system usefulness, 0.91 for informational quality, and 0.89 for interface quality''  \cite{johnson2011ehr, lewis1995ibm, lewis1992psychometric}. We selected this questionnaire since it has been successfully used in the Healthcare domain \cite{johnson2011ehr, jaspers2008pre} and in the evaluation of ``of a guideline-based decision support system'' \cite{johnson2011ehr, goud2008subjective}.

\paragraph*{After Scenario Questionnaire (ASQ)} An additional questionnaire developed by IBM \cite{johnson2011ehr, lewis1995ibm, lewis1991psychometric} and designed to measure the user satisfaction after scenario usability studies have been completed \cite{johnson2011ehr, lewis1992psychometric, bangor2008empirical}. This questionnaire measures the ``ease of task completion, time required to complete the tasks, and satisfaction with support information'' \cite{johnson2011ehr}. Since we already designed the scenario for the evaluation of the system, we included this questionnaire in our study.

\subsection*{Data Model}

Similar to the study we conducted in the insight-based methodology \citep{EMBCLedNiem}, we modeled a patient using clinical expertise of a physician along with the most common symptoms for developing Type II Diabetes. The modeled patient consisted of a set of measurements over time comprised of the following parameters:

\begin{itemize}
	\item Blood pressure: systolic and diastolic blood pressure 
    \item Physical activity: weekly active days\cite{us2008physical, physical2008physical}, steps per day \cite{tudor2004many} 
    \item Body composition: Body Mass Index (BMI), waist diameter and fat percentage
    \item Sleep: time in bed, time asleep  
    \item Fitness: resting heart rate, fitness index \cite{oja2013tester,laukkanen1992validity}, muscular force, muscular endurance and balance \cite{suni2009fitness}
    \item Lab Tests: hemoglobin, fB-Gluc, cholesterol, HDL, LDL, triglycerides 
    \item Nutrition: meal regularity, type of meals (vegetables and fruits), sugar intake, fat quality, fiber and salt intake.
    \item Drugs: tobacco (cigarettes per day), alcohol abuse, drug abuse (narcotics), medication abuse
    \item Emotional wellbeing: depression level \cite{poutanen2010validity}, stress level and stress recovery \cite{firstbeat2014, teisala2014associations} and optimism \cite{scheier1994distinguishing}.
\end{itemize}	

\subsection*{Recruitment}

We recruited a total of 14 participants following similar usability studies and Faulkner's \cite{faulkner2003beyond} recommendation of conducting usability tests with 10 to 20 users ``in order to find 90 to 95\% of usability problems'' \cite{berry2015usability}. Among the 14 participants we were able to recruit 3 usability experts, following the recommendations from Nielsen and a number of previous studies stating that 3 to 5 experts are needed to conduct the Heuristics Evaluation \cite{johnson2011ehr, zhang2003using, nielsen1994usability, shneiderman1992designing, molich1990improving, Tognazzini2014principles}.

We recruited the participants through the university's student email lists and from lectures and self-study groups. We gave a movie ticket to the participants after they completed the usability tests. All participants signed an informed consent explaining the purpose of the tests and how the results were going to be used. The informed consent also explained that their names and identities will be kept confidential, that the results will not be linked to their identities and that the sessions will be recorded using a Web camera and microphone for further study. The participants had the right to withdraw from the tests at any time.

\subsection*{Experiment Protocol}

% Here we described briefly the sequence of steps we took to conduct the experiments. Important to mention we used the camera and microphone to record the test session and review them later for evaluation purposes. 

The testing process started with the signature of an informed consent where we explained the participants the purpose of the test. Afterwards we proceed to explain a usability scenario and the tasks that the participants were asked to complete. The participants were allowed to ask questions at any time. After performing the tasks we asked the participants to fill in the Usability Questionnaires. We close the session with a briefing interview where we asked the users what they liked and disliked about the application as well as what were their recommendations for further improvements. The sessions were recorded for further study and to find the correct timing of the task completion.

\subsection*{Materials and Tools} 

% http://garyperlman.com/quest/
We conducted the usability tests in our laboratory. We used a computer with a local HTTP server running our server application and Google Chrome as the browser running our front-end application. The computer was a laptop with a camera and microphone which were used to record the session for later study. The computer was connected to a 23 inch display and a separate keyboard and mouse. The usability questionnaires were filled out using the Web portal developed by Perlman and available at the following address \url{http://garyperlman.com/quest/} .


\section*{Results}

\subsection*{Heuristic Evaluation}

The three expert users answered the Heuristic Questionnaire in order to identify problems with the user interface of the health monitoring application. The three experts agreed and in some cases strongly agreed most of the indicators. One expert found the instructions for adjusting the time of the visualization tool to be demanding. The expert addressed this comment to the integration interface that allows the time to be adjusted and thus visualized. The remark was not addressed to the graphical representation of the data using hFigures. The results of the evaluation are summarized in table \ref{tbl:heuristicsResults}. The average response was 6.3 out of 7 points.


\subsection*{Cognitive Walkthrough}

% Note : when refencing a source with more than three authors we use et al. 
% The notation has a dot at the end of 'al' and both words are italliced :
% http://blog.apastyle.org/apastyle/2011/02/et-al-when-and-how.html

During the Cognitive Walkthrough, the concept of the health monitoring application was explained to the usability experts. The purpose of the application was explained in the context of the health situation of the modeled patient and how the application visualizes the changes in the health situation over time. We used the usability scenario and tasks to confirm that the interface supports the intended use of the application. The questions comprising the walkthrough, as described by Wharton \textit{et al} \cite{wharton1994cognitive}., were correctly answered by the expert users thus no design or mismatch errors were found.

\subsection*{Controlled User Testing}

Table \ref{tbl:tasksResults} summarizes the results of the completed, number of errors, average time to complete the task and the standard deviation. All participants completed 7 of the 9 tasks. Task 2 was the most problematic, we asked users to ``choose one of these areas and point to its measurements'', we found that 3 participants were not able to understand the task thus unable to complete it. The second most problematic task was number 9, ``understand the difference between the points inside and outside the recommended area'', where one participant was unable to complete it successfully incurring in one non-crucial mistake (an error that prevent the task to be completed). 

Additional non-crucial errors occurred in tasks 1, 3, 4, 6 and 8. The large number occurred in the first task due to the initial values set in the default zoom level of the hFigures component. After the usability testing, we corrected this problem by adjusting the initial zoom level to include the whole figures inside the container.

\subsection*{Usability Questionnaires}

\paragraph*{Computer System Usability Questionnaire (CSUQ)}
We computed the results according to Lewis, obtaining the average of ``items 1 through 19'' to determine the overall usability rating of the system. System usefulness is the average of items 1 to 8, information quality 9 through 15 and interface quality 16 through 18 \cite{lewis2002psychometric}.

Table \ref{tbl:CSUQSystemUsefulnessResults} shows the results of the system usefulness. The system obtained an average of 6.13 out of 7. Table \ref{tbl:CSUQInformationQualityResults} shows the results of the information quality metric where the application scored a total average of 5.66. The average value is still within the ``agree'' response of the participants, however the notable low value compare to the other metrics might be due to the amount of information presented in textual format in the application. The information was encoded using graphical representations and even though a help document was included in the system, the text was not likely to fulfil the users' expectations. Table \ref{tbl:CSUQInterfaceQualityResults} shows the score for the interface quality where the application obtained an average of 6.24 out of 7. The combined results are shown in table \ref{tbl:CSUQOverallUsabilityResults}. The score of the overall usability is 6.02 with a standard deviation of 1.04. We can determine that all the participants at least ``agreed'' in the Likert scale that the application was useful for the decision making process of assessing the health situation and evolution of the modeled patient.

\paragraph*{After Scenario Questionnaire (ASQ)} The average response for the ease of task completion was 6.64 with a standard deviation of 0.842 and for the time required to complete the task 6.64 and a standard deviation of 0.497. The overall satisfaction was 6.46 and a standard deviation of 0.53. The usability of the system had a high score in the ASQ results meaning that the system was suitable for the scenario in the context of the health data visualization of the modeled patient and its evolution over time.

\subsection*{Identified Issues and Suggested Improvements}

The feedback shows that the main problem was the incomplete visibility of the hFigures in the application component window. Users also requested to show the detailed information as a hovering pop up window in the second figure (measurements before the coaching program). Currently only the latest measurements have the hovering window however users requested that both measurements (the before and after) should contain the same functionality. Additional information was needed in the measurements that contained numerical scales, such as the depression index. A more contextualized approach explaining the meaning of the values can help the user understand the measurements and thus the overall health situation of the patient better.

\section*{Discussion}

The value of a data visualization depends on the knowledge that it can convey to the public. In this section, we claim that hFigures has the potential to be used both in the clinical and personal wellness applications. Large amounts of measurements do not clutter the visualization area as a result of our implementation, figure \ref{figureHFiguresComplex} shows an example of a complex holistic visualization of a modeled patient. The comparison of multiple graphs can provide a meaningful visualization to individuals and clinicians alike. The implementation of hFigures follows an extensible approach and even though it was designed to be used for health data visualization, any dataset that has a target range of values as a reference, can be visualized.

\subsection*{Further Development}

We plan to develop the library further to address the suggestions obtained from the participants of the usability testing. The next release of the library already included the fixes for the automatic adjustment of the initial zoom level to show the complete figures within the given container, usually a \texttt{<div>} element in the HTML document. The next item to address is the inclusion of additional information explaining the measurements in the hover pop up window. Additionally we need to develop an algorithm to display the values when hovering on the two figures so that the pop up windows do not overlap.

Further development contemplates a Web Service which consumes a JSON data source file and produces an SVG or a HTML document with the interaction features as a JavaScript file attached. Such service has been already requested in other projects for research purposes in order to provide a better software tool for medical decision making processes.

\subsection*{Translation to Health Care}

The wide variety of EHR formats and data sources from self monitoring applications comprise a challenge in unifying the data in order to provide a holistic overview of a patient. Currently, most of the data sources contain the date when the sample was extracted, whether it is a tracking device or a blood test. This sample date already provides the timestamp required by the hFigures data source file. The values of the samples are the main object of study in a measurement, for instance the levels of cholesterol or sugar at a given time, the number of steps per day, the percentage of body fat and several others. This information can be transformed in a simple process to build the hFigures data source following the JSON structure.

hFigures is a visualization library based on Web technologies, it uses a Web browser and the rendering of the SVG is compatible with current HTML standards. Thus providing interoperability across multiple devices including tablets, smartphones, workstations or laptops is indeed feasible. The D3.js library that hFigures is built on, enables compatibility with Internet Explorer versions 8 and higher using a component named \textit{Aight} \cite{aight}. Internet Explorer 8 is prevalent in hospitals and clinics due to the restrictions in installing custom software.

\subsubsection*{Patient Evolution}

Multiple graphs plotted on the layout of recommended values shows the change in the data over time. This could allow clinicians to understand the evolution of certain aspects in the health of the patient. For instance, health professionals would be able to look at the effect of a trail drug treatment over time. Possibly, the collected samples of a patient before and after starting the trial would be plotted as the multiple graphs portraying the evolution of the patient. Figure \ref{figureHFiguresComplex} shows an example of a more complex dataset. The labels for each individual measurement are usually hidden when a full zoom out is performed by the user. For the purpose of demonstrating the visualization library we have made all the labels visible. 


\subsubsection*{Personal Health Monitoring}

As an example, Fitbit provides activity trackers and a wide-range of devices. The data collected can be obtained through their API. In most cases, providers such as Fitbit follow an HTTP REST interface. Figure \ref{codeFitbitApi} shows an example of the data Fitbit provides through its interface. The data has \texttt{"activities"} as properties of a JavaScript object. These entries have in turn a property \texttt{"startTime"} which provides the timestamp required for the hFigures data source file.

In this case, a step counter contains the property \texttt{"steps"} with the number of steps registered by the device. This and other measurement can be plotted in the hFigures following the data source file structure.

We can also use multiple graphs to show the user-defined goals as a reference in addition to the actual values of the measurement (steps per day). Figure \ref{codeFitbitApi} only show steps per day, however the documentation of the API specifies that additional data is available. This data includes distance travelled, sedentary activity, floors climbed, calories burnt and more.

Other device manufacturers such as Withings or Jawbone provide their users the possibility to use their APIs to extract collected data in a similar way. As in the case of Fitbit, all data has at least a timestamp (date, time or both) and a set of values.

In order to specify the recommended range for these measurements in the hFigures data source file, it is possible to use websites such as WebMD or Mayo Clinic to obtain their recommendation for such values.

% Already explained in the Further Development sub section.
% \subsection*{Future Work}
% We plan to add features to the library and use it in future studies. Animation effects and other graphical elements will be incorporated so as to facilitate the understanding of how the measurements have changed over time. A potential addition to the library includes persuasive design elements to enhance the attitudes towards behavior change.

\section*{Conclusion}

% A user-centered approach was followed to develop a health data visualization library, hFigures. It is based on the design idea of the hGraph but provides additional features. The goal is to enhance users' understanding of health data.

% By comparing multiple graphs, users get a graphical representation of the overall evolution of health measurements with respect to the recommended targets. The label spacing algorithm reduces clutter and visually separates the data into adequate spaces. Groups are clearly divided in the visualization resulting in reduced clutter. This helps users to focus on separate regions of the dataset. The hFigures library also generates an SVG structure embedded in the HTML document. The SVG can be extracted and can be directly utilized as an image file for illustrations in scientific articles and as input for other software applications.

% Based on literature surveys and previous studies \cite{EMBCLedNiem}, we developed hFigures is an open source library that aims to improve the understanding of health data through visualization techniques. The goal is to enhance individuals to take informed decisions in order to change their health behaviors towards a healthier society.

Comprehensive and holistic visualizations of health data empower individuals, citizens and health professionals alike, to better understand situations and take better informed decisions. These decisions can be medical treatment, behaviour change practices, wellness development, health coaching program and more. In this article we detailed the underlying motivation to develop a visualization library inspired by the hGraph. 

% We postulated the hypothesis that based on the successful insight-based evaluation of the hGraph and by addressing users' needs, we can build a visualization library that can assist users in the decision making process by visualizing health data.

We tested the visualization library in the context of an application by conducting usability tests comprised of Heuristics Evaluation, Cognitive Walkthrough and Usability Questionnaires. The results showed that the library was helpful in assisting users in understanding health data and its evolution over time.

The library is an open source tool inspired by the hGraph but with additional key improvements. However, additional improvements and fixes are needed to further develop this tool. In this article, we also discussed how this library can be used in wellness and health processes to understand the evolution of a patient's health and wellness.

Open challenges remain in studying alternative features that can help users identify relationships between measurements, visualize patterns and enable deeper exploration of the data with a higher degree of interactivity.


\section*{Availability and Requirements}

\begin{itemize}
\item \textbf{Project name:} hFigures
\item \textbf{Project home page and source code repository:} \url{https://github.com/ledancs/hFigures}
\item \textbf{Operating System:} Platform independent.
\item \textbf{Programming language:} JavaScript.
\item \textbf{Other requirements:} Developers willing to deploy the application need to serve the files via a Web server. Users require a Web browser to visualize the application.
\item \textbf{License:} Text for this section.
\item \textbf{Any restrictions to use by non-academics:} No.
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Backmatter begins here                   %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{backmatter}

\section*{Abbreviations}
    hGraph: Health graph; hFigures: Health figures; JSON: JavaScript object notation; EHR: Electronic health record; PHR: Personal health record; HTML: Hypertext markup language; SVG: Scalable vector graphics; D3: Data-driven documents; API: Application programming interface.

\section*{Competing Interests}
    The authors declare that they have no competing interests.

\section*{Author's Contributions}
AL developed teh hFigures library. AL and HN wrote jointly the article. HN suggested several use cases that helped shaped the design process. HN contributed in the design and conception of the library. AL, HN and MAM designed the application for health coaching. AL and MAM implemented the application. AL and MAM integrated the application into a Web service. MAM conducted the user testing and analyzed the results.
    
\section*{Acknowledgements}
This research was supported jointly by TEKES (the Finnish Funding Agency for Technology and Innovation) as part of the Digital Health Revolution, as well as the European Commission and TEKES under the ARTEMIS-JU WithMe project.
  
\section*{Author's Information}
AL and HN are part of the Personal Health Informatics research group from the Department of Signal Processing of Tampere University of Technology. AL is a Software Engineer pursuing PhD studies in Health Data Visualization with a strong background in Web Engineering and Health Information Systems. HN is a PhD senior researcher with background in biomedical engineering, signal processing, electrical engineering, user interface design and service design.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                  The Bibliography                       %%
%%                                                         %%
%%  Bmc_mathpys.bst  will be used to                       %%
%%  create a .BBL file for submission.                     %%
%%  After submission of the .TEX file,                     %%
%%  you will be prompted to submit your .BBL file.         %%
%%                                                         %%
%%                                                         %%
%%  Note that the displayed Bibliography will not          %%
%%  necessarily be rendered by Latex exactly as specified  %%
%%  in the online Instructions for Authors.                %%
%%                                                         %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% if your bibliography is in bibtex format, use those commands:
\bibliographystyle{bmc-mathphys} % Style BST file (bmc-mathphys, vancouver, spbasic).
\bibliography{bmc_article}      % Bibliography file (usually '*.bib' )

% or include bibliography directly:
% \begin{thebibliography}
% \bibitem{b1}
% \end{thebibliography}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                               %%
%% Figures                       %%
%%                               %%
%% NB: this is for captions and  %%
%% Titles. All graphics must be  %%
%% submitted separately and NOT  %%
%% included in the Tex document  %%
%%                               %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%
%% Do not use \listoffigures as most will included as separate files

\section*{Figures}

%%%%%%%%%%%%%%%%
% Code figures %
%%%%%%%%%%%%%%%%

% Data source
\begin{figure}[h!]
  \caption{\csentence{JSON data source file.} The data source file structured as a JSON file.}
  \label{codeDataSource}
\end{figure}

% Layout construction
\begin{figure}[h!]
  \caption{\csentence{Layout construction code.} The layout for distributing the measurements is build using d3 pie layout leaving spaced between the measurement groups.}
  \label{codeLayoutConstruction}
\end{figure}

% fitbit API
\begin{figure}[h!]
  \caption{\csentence{Fitbit API example response.} An example JSON response from a Fitbit activity sensor that can be transformed to a data source to be visualized by hFigures.}
  \label{codeFitbitApi}
\end{figure}

% Label positioning
\begin{figure}[h!]
  \caption{\csentence{JavaScript code for label positioning.} The function in JavaScript distributed the positioning of the label to avoid overlapping and clutter.}
  \label{codeVerticalLabelDistribution}
\end{figure}

% Color-coded entries
\begin{figure}[h!]
  \caption{\csentence{JavaScript code to determine if additional ranges are provided.} In JavaScript the data source could contain additional ranges, these are properties in an object that need to be checked beforehand and if the exists, compare the values accordingly.}
  \label{codeColorCoded}
\end{figure}

%%%%%%%%%%%%%%%%%%
% Visualizations %
%%%%%%%%%%%%%%%%%%

% Sonin's hGraph
\begin{figure}[h!]
  \caption{\csentence{An example of the hGraph.} The hGraph shows an overview at a low zoom level. When the zoom increases, the details of each measurement are revealed.}
  \label{figureHGraphZoom}
\end{figure}

% hFigures simple example
\begin{figure}[h!]
  \caption{\csentence{A simple example of hFigures.} The measurements are separated by groups in sectors.}
  \label{figureHFiguresSimple}
\end{figure}

% Radius and measurement labels
\begin{figure}[h!]
  \caption{\csentence{Label positioning avoiding overlapping with measurements.} Some measurements can be positioned outside of the recommended range, the labels are adjusted to avoid overlapping.}
  \label{figureRadiusMeasurementDistrbution}
\end{figure}

% Label positioning
\begin{figure}[h!]
  \caption{\csentence{Label positioning distribution.} The labels are positioned according the their height and margin, as a result the labels do not overlap and clutter is avoided.}
  \label{figureVerticalLabelDistribution}
\end{figure}

% hFigures complex
\begin{figure}[h!]
  \caption{\csentence{A complex hFigures example.} A holistic health assessment of a modeled person comprised of several measurements with two time snapshots showing the person's evolution.}
  \label{figureHFiguresComplex}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                               %%
%% Tables                        %%
%%                               %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Use of \listoftables is discouraged.
%%
\section*{Tables}

\begin{table}[h!]
\caption{Comparative Functionality Table. The table lists the features supported by hFigures and hGraph.}
      \begin{tabular}{lcc}
        \hline
        Functionality                            & hFigures  & hGraph    \\ \hline
        Color-coded measurements                 & \ding{51} & Partially \\ 
        Recommended area                         & \ding{51} & \ding{51} \\ 
        Circular distribution of measurements    & \ding{51} & \ding{51} \\ 
        Plot values at specific times            & \ding{51} & ---       \\ 
        Time series data source                  & \ding{51} & ---       \\ 
        Immutable shape                          & \ding{51} & ---       \\ 
        Weighted score                           & ---       & \ding{51} \\ 
     		Multiple graphs                          & \ding{51} & ---       \\
    		Visible category labels                  & \ding{51} & ---       \\
    		Label space distribution                 & \ding{51} & Partially \\
    		Grouped measurements                     & \ding{51} & ---       \\
    		SVG export                               & \ding{51} & ---        \\ \hline
		
      \end{tabular}
\label{tbl:features}
\end{table}

\begin{table}[h!]
\caption{Standard Questionnaires Table. The table lists the standard questionnaires we used for the user evaluation of the system with their length, reliability and metrics.}
      \begin{tabular}{lccL{3.5cm}}
        \hline
         & Items & Reliability & Metrics \\ \hline
        \multirow{4}{*}{CSUQ} & \multirow{4}{*}{19} & 0.93 & Usefulness \\
         & & 0.91 & Information Quality \\
   		 & & 0.89 & Interface Quality \\
   		 & & 0.95 & Overall Usability \\ \hline
% ease of task completion, time required to complete tasks, and satisfaction
        \multirow{3}{*}{ASQ} & \multirow{3}{*}{3} & \multirow{3}{*}{0.93} & Ease of Task Completion \\
         & & & Time Required to Complete the Task \\
         & & & Satisfaction \\ \hline
		
      \end{tabular}
\label{tbl:questionnaires}
\end{table}

\begin{table}[h!]
\caption{Heuristic Evaluation Results. The table summarizes the results of the Heuristic Evaluation conducted by three usability experts.}
      \begin{tabular}{p{3.85cm}R{1.2cm}R{1.2cm}}
      \hline
      Heuristic & Average Response & Standard Deviation \\ \hline
      Visibility of system status & 6.00 & 1.00 \\
      Match between system and the real world & 6.33 & 0.577 \\
      User control and freedom & 6.33 & 0.57 \\
      Consistency and standards & 6.67 & 0.57 \\
      Error prevention & 6.33 & 0.57 \\
      Recognition rather than recall & 4.67 & 0.57 \\
      Flexibility and efficiency of use & 6.67 & 0.57 \\
      Aesthetic and minimalist design & 7.00 & 0.00 \\
      Help users recognize, diagnose, and recover from errors & 6.33 & 0.57 \\
      Help and documentation & 6.67 & 0.57 \\ \hline
      Nielsen heuristic evaluation & 6.30 & .562 \\ \hline
      \end{tabular}
\label{tbl:heuristicsResults}
\end{table}

\begin{table}[h!]
\caption{Controlled User Testing Results. The table summarizes the results of the 14 users performing the 9 tasks.}
      \begin{tabular}{lC{1.5cm}C{0.75cm}R{1.2cm}R{1.2cm}}
      \hline
      Task & Successfully Completed & Errors & Average Time (seconds) & Standard Deviation (seconds)\\ \hline
      Task 1 & 14 & 4 & 12.2 & 12.6 \\
      Task 2 & 11 & 0 & 10.0 & 12.4 \\
      Task 3 & 14 & 1 & 10.8 &  5.4 \\
      Task 4 & 14 & 2 &  6.8 &  5.0 \\
      Task 5 & 14 & 0 & 17.5 & 6.6 \\ 
      Task 6 & 14 & 2 & 16.1 & 16.5 \\ 
      Task 7 & 14 & 0 &  6.2 & 5.6 \\ 
      Task 8 & 14 & 1 &  7.9 & 5.9 \\ 
      Task 9 & 13 & 1 &  9.2 & 4.7 \\ \hline
      \end{tabular}
\label{tbl:tasksResults}
\end{table}

\begin{table}[h!]
\caption{Computer System Usability Questionnaire Results for the System Usefulness assessment. The table shows the results of the questions corresponding to the System Usefulness with its average and standard deviation.}
      \begin{tabular}{L{3.85cm}R{1.2cm}R{1.2cm}}
      \hline
      Question & Average Response & Standard Deviation \\ \hline
      Overall, I am satisfied with how easy it is to use this system & 6.29 & 0.99 \\
      It was simple to use this system & 6.07 & 1.20 \\
      I can effectively complete my work using this system & 6.07 & 1.07 \\
      I am able to complete my work quickly using this system & 5.86 & 1.40 \\
      I am able to efficiently complete my work using this system & 6.21 & 0.89 \\
      I feel comfortable using this system & 6.21 & 0.97 \\
      It was easy to learn to use this system & 6.43 & 0.85 \\
      I believe I became productive quickly using this system & 5.93 & 1.26 \\ \hline
      System Usefulness & 6.13 & 0.93 \\ \hline
      \end{tabular}
\label{tbl:CSUQSystemUsefulnessResults}
\end{table}

\begin{table}[h!]
\caption{Computer System Usability Questionnaire Results for Information Quality.}
      \begin{tabular}{L{3.85cm}R{1.2cm}R{1.2cm}}
      \hline
      Question & Average Response & Standard Deviation \\ \hline
      The system gives error messages that clearly tell me how to fix problems & 4.50 & 2.44 \\
      Whenever I make a mistake using the system, I recover easily and quickly & 5.43 & 1.95 \\
      The information (such as online help, on-screen mes-sages, and other documentation) provided     with this system is clear & 5.29 & 1.90 \\
      It is easy to find the information I needed & 6.07 & 1.27 \\
      The information provided for the system is easy to un-derstand &  5.93 & 1.39 \\
      The information is effective in helping me complete the tasks and scenarios & 6.14 & 1.17 \\
      The organization of information on the system screens is clear & 6.29 & 1.14 \\ \hline
      Information Quality & 5.66 & 1.20 \\ \hline
      \end{tabular}
\label{tbl:CSUQInformationQualityResults}
\end{table}

\begin{table}[h!]
\caption{Computer System Usability Questionnaire Results for Interface Quality.}
      \begin{tabular}{L{3.85cm}R{1.2cm}R{1.2cm}}
      \hline
      Question & Average Response & Standard Deviation \\ \hline
      The interface of this system is pleasant & 6.36 & 1.00 \\
      I like using the interface of this system & 6.36 & .929 \\
      This system has all the functions and capabilities I expect it to have & 6.00 & 1.18 \\ \hline
      Interface Quality & 6.24 & .999 \\ \hline
      \end{tabular}
\label{tbl:CSUQInterfaceQualityResults}
\end{table}

\begin{table}[h!]
\caption{Computer System Usability Questionnaire Results for Overall Usability, System Usefulness, Information and Interface Quality.}
      \begin{tabular}{L{2.5cm}lR{1.2cm}R{1.2cm}}
      \hline
      Metric & Questions & Average Response & Standard Deviation \\ \hline
      Overall Usability   &  1-19 & 6.02 & 1.04 \\ 
      System Usefulness   &  1-8  & 6.13 & 0.93 \\ 
      Information Quality &  9-15 & 5.66 & 1.20 \\ 
      Interface Quality   & 16-18 & 6.24 & .999 \\ \hline
      \end{tabular}
\label{tbl:CSUQOverallUsabilityResults}
\end{table}

\begin{table}[h!]
\caption{After Scenario Questionnaire Results.}
      \begin{tabular}{L{3.85cm}R{1.2cm}R{1.2cm}}
      \hline
      Question & Average Time (seconds) & Standard Deviation (seconds)\\ \hline
      Overall, I am satisfied with the ease of completing the tasks in this scenario & 6.64 & .842 \\
      Overall, I am satisfied with the amount of time it took to complete the tasks in this scenario & 6.64 & .497 \\
      Overall Satisfaction of the system & 6.46 & .531 \\ \hline
      \end{tabular}
\label{tbl:ASQResults}
\end{table}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                               %%
%% Additional Files              %%
%%                               %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\section*{Additional Files}
%  \subsection*{hFigures}
%    Additional file descriptions text (including details of how to
%    view the file, if it is in a non-standard format or the file extension).  This might
%    refer to a multi-page table or a figure.
%
%  \subsection*{Additional file 2 --- Sample additional file title}
%    Additional file descriptions text.


\end{backmatter}
\end{document}
